# Folio — Caddy Reverse Proxy Configuration
#
# The {$DOMAIN} variable defaults to "localhost" for local development.
# For production on Oracle Free Tier, set DOMAIN in your .env file.
#
# ── Production with DuckDNS (free dynamic DNS + auto HTTPS) ──
#
# 1. Create a free account at https://www.duckdns.org
# 2. Register a subdomain (e.g., myfolio.duckdns.org)
# 3. Point it to your Oracle VM's public IP
# 4. Set DOMAIN=myfolio.duckdns.org in your .env
# 5. Caddy will automatically provision a Let's Encrypt certificate
#
# For custom domains, just set DOMAIN=yourdomain.com and ensure
# DNS A record points to your server. Caddy handles the rest.

{$DOMAIN:localhost} {
	# Reverse proxy all requests to the Folio API
	reverse_proxy api:8080

	# Encode responses with gzip/zstd for performance
	encode gzip zstd

	# Security headers
	header {
		X-Content-Type-Options "nosniff"
		X-Frame-Options "DENY"
		Referrer-Policy "strict-origin-when-cross-origin"
		X-XSS-Protection "1; mode=block"
		-Server
	}

	# Logging
	log {
		output stdout
		format console
	}
}
